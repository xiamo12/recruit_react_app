{"version":3,"file":"index.cjs.js","sources":["../src/utilities.js","../src/customizers/webpack.js","../src/customizers/babel.js","../src/overrides.js"],"sourcesContent":["export const getBabelLoader = (config, isOutsideOfApp) => {\n  let babelLoaderFilter;\n  if (isOutsideOfApp) {\n    babelLoaderFilter = rule =>\n    rule.loader &&\n    rule.loader.includes(\"babel\") &&\n    rule.exclude;\n  } else {\n    babelLoaderFilter = rule =>\n    rule.loader &&\n    rule.loader.includes(\"babel\") &&\n    rule.include;\n  }\n\n  // First, try to find the babel loader inside the oneOf array.\n  // This is where we can find it when working with react-scripts@2.0.3.\n  let loaders = config.module.rules.find(rule => Array.isArray(rule.oneOf))\n    .oneOf;\n\n  let babelLoader = loaders.find(babelLoaderFilter);\n\n  // If the loader was not found, try to find it inside of the \"use\" array, within the rules.\n  // This should work when dealing with react-scripts@2.0.0.next.* versions.\n  if (!babelLoader) {\n    loaders = loaders.reduce((ldrs, rule) => ldrs.concat(rule.use || []), []);\n    babelLoader = loaders.find(babelLoaderFilter);\n  }\n  return babelLoader;\n};\n","import { getBabelLoader } from \"../utilities\";\n\nexport const addBundleVisualizer = (\n  options = {},\n  behindFlag = false\n) => config => {\n  const BundleAnalyzerPlugin = require(\"webpack-bundle-analyzer\")\n    .BundleAnalyzerPlugin;\n\n  // if behindFlag is set to true, the report will be created only if\n  // the `--analyze` flag is added to the `yarn build` command\n  if (behindFlag ? process.argv.includes(\"--analyze\") : true) {\n    config.plugins.push(\n      new BundleAnalyzerPlugin(\n        Object.assign(\n          {\n            analyzerMode: \"static\",\n            reportFilename: \"report.html\"\n          },\n          options\n        )\n      )\n    );\n  }\n  return config;\n};\n\nexport const disableEsLint = () => config => {\n  let eslintRules = config.module.rules.filter(\n    r => r.use && r.use.some(u => u.options && u.options.useEslintrc !== void 0)\n  );\n  eslintRules.forEach(rule => {\n    config.module.rules = config.module.rules.filter(r => r !== rule);\n  });\n  return config;\n};\n\nexport const addWebpackAlias = alias => config => {\n  if (!config.resolve) {\n    config.resolve = {};\n  }\n  if (!config.resolve.alias) {\n    config.resolve.alias = {};\n  }\n  Object.assign(config.resolve.alias, alias);\n  return config;\n};\n\nexport const addWebpackResolve = resolve => config => {\n  if (!config.resolve) {\n    config.resolve = {};\n  }\n  Object.assign(config.resolve, resolve);\n  return config;\n};\n\nexport const addWebpackPlugin = plugin => config => {\n  config.plugins.push(plugin);\n  return config;\n};\n\nexport const adjustWorkbox = adjust => config => {\n  config.plugins.forEach(p => {\n    if (p.constructor.name === \"GenerateSW\") {\n      adjust(p.config);\n    }\n  });\n  return config;\n};\n\nexport const useEslintRc = configFile => config => {\n  const eslintRule = config.module.rules.filter(\n    r => r.use && r.use.some(u => u.options && u.options.useEslintrc !== void 0)\n  )[0];\n\n  eslintRule.use[0].options.useEslintrc = true;\n  eslintRule.use[0].options.ignore = true;\n  eslintRule.use[0].options.configFile = configFile;\n\n  delete eslintRule.use[0].options.baseConfig;\n\n  const rules = config.module.rules.map(r =>\n    r.use && r.use.some(u => u.options && u.options.useEslintrc !== void 0)\n      ? eslintRule\n      : r\n  );\n  config.module.rules = rules;\n\n  return config;\n};\n\nexport const enableEslintTypescript = () => config => {\n  const eslintRule = config.module.rules.filter(\n    r => r.use && r.use.some(u => u.options && u.options.useEslintrc !== void 0)\n  )[0];\n\n  eslintRule.test = /\\.([j,t]sx?|mjs)$/;\n\n  const rules = config.module.rules.map(r =>\n    r.use && r.use.some(u => u.options && u.options.useEslintrc !== void 0)\n      ? eslintRule\n      : r\n  );\n  config.module.rules = rules;\n\n  return config;\n};\n\nexport const addLessLoader = (loaderOptions = {}) => config => {\n  const mode = process.env.NODE_ENV === \"development\" ? \"dev\" : \"prod\";\n\n  // Need these for production mode, which are copied from react-scripts\n  const publicPath = require(\"react-scripts/config/paths\").servedPath;\n  const shouldUseRelativeAssetPaths = publicPath === \"./\";\n  const shouldUseSourceMap =\n    mode === \"prod\" && process.env.GENERATE_SOURCEMAP !== \"false\";\n  const lessRegex = /\\.less$/;\n  const lessModuleRegex = /\\.module\\.less$/;\n  const localIdentName =\n    loaderOptions.localIdentName || \"[path][name]__[local]--[hash:base64:5]\";\n\n  const getLessLoader = cssOptions => {\n    return [\n      mode === \"dev\"\n        ? require.resolve(\"style-loader\")\n        : {\n            loader: require(\"mini-css-extract-plugin\").loader,\n            options: Object.assign(\n              {},\n              shouldUseRelativeAssetPaths ? { publicPath: \"../../\" } : undefined\n            )\n          },\n      {\n        loader: require.resolve(\"css-loader\"),\n        options: cssOptions\n      },\n      {\n        loader: require.resolve(\"postcss-loader\"),\n        options: {\n          ident: \"postcss\",\n          plugins: () => [\n            require(\"postcss-flexbugs-fixes\"),\n            require(\"postcss-preset-env\")({\n              autoprefixer: {\n                flexbox: \"no-2009\"\n              },\n              stage: 3\n            })\n          ],\n          sourceMap: shouldUseSourceMap\n        }\n      },\n      {\n        loader: require.resolve(\"less-loader\"),\n        options: Object.assign(loaderOptions, {\n          source: shouldUseSourceMap\n        })\n      }\n    ];\n  };\n\n  const loaders = config.module.rules.find(rule => Array.isArray(rule.oneOf))\n    .oneOf;\n\n  // Insert less-loader as the penultimate item of loaders (before file-loader)\n  loaders.splice(\n    loaders.length - 1,\n    0,\n    {\n      test: lessRegex,\n      exclude: lessModuleRegex,\n      use: getLessLoader({\n        importLoaders: 2\n      }),\n      sideEffects: mode === \"prod\"\n    },\n    {\n      test: lessModuleRegex,\n      use: getLessLoader({\n        importLoaders: 2,\n        modules: true,\n        localIdentName: localIdentName\n      })\n    }\n  );\n\n  return config;\n};\n\n// to be used inside `overrideDevServer`, makes CRA watch all the folders\n// included `node_modules`, useful when you are working with linked packages\n// usage: `yarn start --watch-all`\nexport const watchAll = () => config => {\n  if (process.argv.includes(\"--watch-all\")) {\n    delete config.watchOptions;\n  }\n  return config;\n};\n\n// to be used to disable chunk according to:\n// https://github.com/facebook/create-react-app/issues/5306#issuecomment-433425838\nexport const disableChunk = () => config => {\n  config.optimization.splitChunks = {\n    cacheGroups: {\n      default: false\n    }\n  };\n\n  config.optimization.runtimeChunk = false;\n\n  return config;\n};\n\n// to be used to ignore replace packages with global variable\n// Useful when trying to offload libs to CDN\nexport const addWebpackExternals = externalDeps => config => {\n  let externals = config.externals;\n  if (!externals) {\n    externals = externalDeps;\n\n  } else if (Array.isArray(externalDeps)) {\n    externals = externalDeps.concat(externals);\n\n  } else if (Array.isArray(externals)\n    || externalDeps.constructor === Function\n    || externalDeps.constructor === RegExp) {\n    externals = [externalDeps].concat(externals);\n\n  } else if (externalDeps instanceof Object\n    && externals instanceof Object) {\n    externals = {\n      ...externals,\n      ...externalDeps,\n    };\n  }\n\n  config.externals = externals;\n  return config;\n};\n\nexport const addPostcssPlugins = plugins => config => {\n  const rules = config.module.rules.find(rule => Array.isArray(rule.oneOf))\n    .oneOf;\n  rules.forEach(\n    r =>\n      r.use &&\n      r.use.forEach(u => {\n        if (u.options && u.options.ident === \"postcss\") {\n          if (!u.options.plugins) {\n            u.options.plugins = () => [...plugins];\n          }\n          if (u.options.plugins) {\n            const originalPlugins = u.options.plugins;\n            u.options.plugins = () => [...originalPlugins(), ...plugins];\n          }\n        }\n      })\n  );\n  return config;\n};\n\n// This will remove the CRA plugin that prevents to import modules from\n// outside the `src` directory, useful if you use a different directory\nexport const removeModuleScopePlugin = () => config => {\n  config.resolve.plugins = config.resolve.plugins.filter(\n    p => p.constructor.name !== \"ModuleScopePlugin\"\n  );\n  return config;\n};\n\nexport const addTslintLoader = options => config => {\n  config.module.rules.unshift({\n    test: /\\.(ts|tsx)$/,\n    loader: \"tslint-loader\",\n    options,\n    enforce: \"pre\"\n  });\n  return config;\n};\n","import { getBabelLoader } from \"../utilities\";\n\nexport const addBabelPlugin = plugin => config => {\n  getBabelLoader(config).options.plugins.push(plugin);\n  return config;\n};\n\nexport const addExternalBabelPlugin = plugin => config => { \n  const outsideBabelOptions = getBabelLoader(config, true).options;\n  if (!outsideBabelOptions.plugins) {\n    outsideBabelOptions.plugins = [];\n  }\n  outsideBabelOptions.plugins.push(plugin);\n  return config;\n};\n\nexport const addBabelPreset = preset => config => {\n  getBabelLoader(config).options.presets.push(preset);\n  return config;\n};\n\nexport const addDecoratorsLegacy = () => config =>\n  addBabelPlugin([\"@babel/plugin-proposal-decorators\", { legacy: true }])(\n    config\n  );\n\nexport const useBabelRc = () => config => {\n  getBabelLoader(config).options.babelrc = true;\n  return config;\n};\n\nexport const babelInclude = include => config => {\n  getBabelLoader(config).include = include;\n  return config;\n};\n\nexport const addBabelPlugins = (...plugins) =>\n  plugins.map(p => addBabelPlugin(p));\n\nexport const addExternalBabelPlugins = (...plugins) =>\n  plugins.map(p => addExternalBabelPlugin(p));\n\nexport const addBabelPresets = (...plugins) =>\n  plugins.map(p => addBabelPreset(p));\n\nexport const fixBabelImports = (libraryName, options) =>\n  addBabelPlugin([\n    \"import\",\n    Object.assign(\n      {},\n      {\n        libraryName\n      },\n      options\n    ),\n    `fix-${libraryName}-imports`\n  ]);\n","import flow from \"lodash.flow\";\n\nexport const override = (...plugins) => flow(...plugins.filter(f => f));\n\n// Use this helper to override the webpack dev server settings\n//  it works just like the `override` utility\nexport const overrideDevServer = (...plugins) => configFunction => (\n  proxy,\n  allowedHost\n) => {\n  const config = configFunction(proxy, allowedHost);\n  const updatedConfig = override(...plugins)(config);\n  return updatedConfig;\n};\n"],"names":["getBabelLoader","config","isOutsideOfApp","babelLoaderFilter","rule","loader","includes","exclude","include","loaders","module","rules","find","Array","isArray","oneOf","babelLoader","reduce","ldrs","concat","use","addBundleVisualizer","options","behindFlag","BundleAnalyzerPlugin","require","process","argv","plugins","push","Object","assign","analyzerMode","reportFilename","disableEsLint","filter","r","some","u","useEslintrc","forEach","addWebpackAlias","alias","resolve","addWebpackResolve","addWebpackPlugin","plugin","adjustWorkbox","adjust","p","constructor","name","useEslintRc","configFile","eslintRule","ignore","baseConfig","map","enableEslintTypescript","test","addLessLoader","loaderOptions","mode","env","NODE_ENV","shouldUseRelativeAssetPaths","servedPath","shouldUseSourceMap","GENERATE_SOURCEMAP","lessModuleRegex","localIdentName","getLessLoader","cssOptions","publicPath","undefined","ident","autoprefixer","flexbox","stage","sourceMap","source","splice","length","importLoaders","sideEffects","modules","watchAll","watchOptions","disableChunk","optimization","splitChunks","cacheGroups","default","runtimeChunk","addWebpackExternals","externalDeps","externals","Function","RegExp","addPostcssPlugins","originalPlugins","removeModuleScopePlugin","addTslintLoader","unshift","enforce","addBabelPlugin","addExternalBabelPlugin","outsideBabelOptions","addBabelPreset","preset","presets","addDecoratorsLegacy","legacy","useBabelRc","babelrc","babelInclude","addBabelPlugins","addExternalBabelPlugins","addBabelPresets","fixBabelImports","libraryName","override","flow","f","overrideDevServer","configFunction","proxy","allowedHost"],"mappings":"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"}